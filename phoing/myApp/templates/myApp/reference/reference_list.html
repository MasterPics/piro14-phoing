{% extends 'myApp/layout.html' %}
{% load static %}

{% block stylesheet %}
<link rel="stylesheet" href="{% static 'css/contact/contact.css' %}">
{% endblock stylesheet %}
{% block content %}

<div class="infinite-container reference_content">
    {% for reference in references %}

    {% endfor %}
</div>

{% endblock content %}
<!--js-->
{% block script %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"
    integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="{% static 'js/jquery.waypoints.min.js' %}"></script>
<script src="{% static 'js/infinite.min.js' %}"></script>

<script type='text/javascript'>
    // like
    const onClickLike = async (reference_id) => {
        try {
            const options = {
                url: '/reference/like/',
                method: 'POST',
                data: {
                    reference_id: reference_id,
                }
            }
            const response = await axios(options)
            const responseOK = response && response.status === 200 && response.statusText === 'OK'
            if (responseOK) {
                const data = response.data
                modifyLike(data.reference_id, data.is_liked)
            }
        } catch (error) {
            console.log(error)
        }
    }

    const modifyLike = (reference_id, is_liked) => {
        const like = document.querySelector(`.like-${reference_id} i`);
        const like_content = document.querySelector(`.like-${reference_id} .like__content`)
        const num = like_content.innerText; // [ {{ reference.like_users.count }} ]
        console.log(num)
        if (is_liked === true) {

            like.className = "fas fa-heart";

            const count = Number(num) + 1;
            like_content.innerHTML = count
        } else {
            like.className = "far fa-heart";

            const count = Number(num) - 1;
            like_content.innerHTML = count
        }

    }


    // save
    const onClickSave = async (reference_id) => {
        try {
            const options = {
                url: '/reference/save/',
                method: 'POST',
                data: {
                    reference_id: reference_id,
                }
            }
            const response = await axios(options)
            const responseOK = response && response.status === 200 && response.statusText === 'OK'
            if (responseOK) {
                const data = response.data
                modifySave(data.reference_id, data.is_saved)
            }
        } catch (error) {
            console.log(error)
        }
    }

    const modifySave = (reference_id, is_saved) => {
        const save = document.querySelector(`.save-${reference_id} i`);
        const save_content = document.querySelector(`.save-${reference_id} .save__content`)
        const num = save_content.innerText;
        console.log(num)
        if (is_saved === true) {

            save.className = "fas fa-bookmark";

            const count = Number(num) + 1;
            save_content.innerHTML = count
        } else {
            save.className = "far fa-bookmark";

            const count = Number(num) - 1;
            save_content.innerHTML = count
        }

    }
</script>
{% endblock script %}